<!DOCTYPE html>
<html>
<head>
<title>
Chart 1
</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
</head>
<body>
<center>
<div class="toplinks">  
    <a href="https://michael-d-johnson.github.io/about">Description</a>
</div>
<div id="viz" width="600" height="600"></div>
<div id="tooltip"></div>
<input type="button" onclick="location.href='https://michael-d-johnson.github.io/next_scene';" value="Next" style="float:right"/>
</center>
<style>
#tooltip {
    opacity: 0;
    position: absolute;
    text-align: center;
    width: 75px; height: 20px;
    background: white;
    border: 0px;
    color: black;
}
</style>
<script>
    // Source: https://www.kdnuggets.com/2018/03/simple-bar-chart-d3.html
    var tooltip = d3.select("#tooltip");

    //set the margin of the SVG
    var margin = {top: 50, right: 50, bottom: 50, left: 50}

    //set the width and height using the current width and height of the SVG
    var width = 600 - margin.left - margin.right;
    var height = 600 - margin.top - margin.bottom;
    
    var svg = d3.select("#viz").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height",height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

    var x = d3.scaleBand()
        .range([0,width]);
    var y = d3.scaleLinear()
        .range([height,0]);

    d3.csv("static/all_natl_data.filtered.totalcostsal.csv", function(error,data) {
        if (error) throw error;
            console.log(data); 

            //format the data
            data.forEach(function(d) {
                d.YEAR = +d.YEAR;
                d.TOTALCOST = +d.TOTALCOST
                d.TOTSAL = +d.TOTSAL;
            });
        
            x.domain(data.map(function(d) { return d.YEAR;}));
            y.domain([0,d3.max(data,function(d) {return d.TOTALCOST;})]);

        svg.selectAll(".bar")
        .data(data)
        .enter().append("rect")
        .filter(function(d) {return d.FMTASSISTED = "'1 Assisted'";})
        .attr("class","bar1")
        .attr("x",function(d) {return x(d.YEAR);})
        .attr("width",x.bandwidth())
        .attr("y", function(d) { return y(d.TOTALCOST);})
        .attr("height",function(d) { return height - y(d.TOTALCOST);})
        .attr("fill", "blue")
        .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html(+d.TOTALCOST);
                    d3.select(this).attr("fill","red")})
        .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("fill", "blue")})

        svg.selectAll(".bar")
        .data(data)
        .enter().append("rect")
        .filter(function(d) {return d.FMTASSISTED= "'0 Not Assisted'";})
        .attr("class","bar2")
        .attr("x",function(d) {return x(d.YEAR);})
        .attr("width",x.bandwidth())
        .attr("y",function(d) {return y(d.TOTALCOST);})
        .attr("height",function(d) { return height - y(d.TOTALCOST);})
        .attr("fill", "darkgray")
        .attr("opacity",0.75)
        .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html(+d.TOTALCOST);
                    d3.select(this).attr("fill","red")})
        .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("fill", "darkgray")})



        svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));
        
        svg.append("g")
        .call(d3.axisLeft(y));

        svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-decoration", "underline")  
        .text("Average Total Salary vs. Year");
        });
</script>
</body>
</html>
