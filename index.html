<!DOCTYPE html>
<html>
<head>
<title>
Scene 1
</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
</head>
<body>
<center>
<div id="viz" width="600" height="600"></div>
<div id="tooltip"></div>
<input id="button" type="button" onclick="location.href='https://michael-d-johnson.github.io/next_scene';" value="Next" style="float:right"/>
<input id="button" type="button" onclick="location.href='https://michael-d-johnson.github.io/about';" value="Description" style="float:right"/>
</center>
<style>
.annotation {
    opacity: 0;
    position: absolute;
    text-align: left;
    width: 80px; height: 40px;
    background: lightcoral;
    border: 2px solid coral;
    color: white;
}

#tooltip {
    opacity: 0;
    position: absolute;
    text-align: left;
    width: 80px; height: 35px;
    background: whitesmoke;
    border: 1px solid black;
    color: black;
}
#button {
   background: steelblue;
   color: white;
}
</style>
<center>
<script>
    // Source: https://bl.ocks.org/mbostock/3884955
    var tooltip = d3.select("#tooltip");

    //set the margin of the SVG
    var margin = {top: 50, right: 100, bottom: 50, left: 100}

    //set the width and height using the current width and height of the SVG
    var width = 600 - margin.left - margin.right;
    var height = 600 - margin.top - margin.bottom;
    
    var svg = d3.select("#viz").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height",height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

    var x = d3.scaleBand()
        .range([0,width]);
    var y = d3.scaleLinear()
        .range([height,0]);

    // define the line
    var line = d3.line()
        .x(function(d) { return x(d.YEAR); })
        .y(function(d) { return y(d.TOTALCOST); });

    d3.csv("static/all_natl_data.filtered.NotAssisted.csv", function(error1,data1) {
        d3.csv("static/all_natl_data.filtered.Assisted.csv",function(error2,data2) {
            if (error1) throw error;
                if (error2) throw error;
                //format the data
                data1.forEach(function(d) {
                    d.YEAR = +d.YEAR;
                    d.TOTALCOST = +d.TOTALCOST
                    d.TOTSAL = +d.TOTSAL;})
                data2.forEach(function(d) {
                    d.YEAR = +d.YEAR;
                    d.TOTALCOST = +d.TOTALCOST
                    d.TOTSAL = +d.TOTSAL;});

            //printing data
            //console.log(data1); 
            //console.log(data2);

            x.domain(data1.map(function(d) { return d.YEAR;}));
            y.domain([0,d3.max(data1,function(d) {return d.TOTALCOST;})]);


        svg.append("path")
        .datum(data1)
        .attr("fill", "none")
        .attr("class","line")
        .attr("stroke", "orange")
        .attr("stroke-width", 0)
        .attr("d", line)

        svg.append("path")
        .datum(data2)
        .attr("fill", "none")
        .attr("class","line")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 0)
        .attr("d", line)

        svg.selectAll("dot")
        .data(data1)
        .enter().append("circle")
        .attr("class","dot")
        .attr("r",0)
        .attr("fill","orange")
        .attr("cx", function(d) { return x(d.YEAR); })		 
        .attr("cy", function(d) { return y(d.TOTALCOST); })	
        .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html("Year: " + d.YEAR + "<br/>Cost: $" + d.TOTALCOST)
                   .style("font-size","14px")
                   d3.select(this).attr("r",10)})
        .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("r", 6)})
        svg.selectAll("dot")
        .data(data2)
        .enter().append("circle")
        .attr("class","dot")
        .attr("r",0)
        .attr("fill", funtion(d) { 
          if (d.YEAR = 2007)
              return "coral ;}
         else{return "steelblue;}

        .attr("cx", function(d) { return x(d.YEAR); })		 
        .attr("cy", function(d) { return y(d.TOTALCOST); })	
        .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html("Year: " + d.YEAR + "<br/>Cost: $" + d.TOTALCOST)
                   .style("font-size","14px")
                   d3.select(this).attr("r",10)})
        .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("r", 6)})

        svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));
        
        svg.append("g")
        .call(d3.axisLeft(y));

        // add labels
        svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "20px") 
        .style("text-decoration", "underline")  
        .style("text-decoration","bold")
        .text("Average Total Cost of Housing per Year");

        svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", 0 - (height / 2))
        .attr("y",0 - 50)
        .style("text-anchor", "middle")
        .text("Average Total Cost of Housing (USD)");

        svg.append("text")
        .attr("class", "x label")
        .attr("text-anchor", "middle")
        .attr("x", width/2 )
        .attr("y", height + margin.bottom)
        .text("Year");

        svg.append("text")
        .attr("class", "annotation")
        .attr("text-anchor", "middle")
        .attr("y", margin.top + height/2)
        .attr("x", .75*width)
        .text("This is an annotation.");

        var legend_keys = ["Assisted", "Unassisted"]

        var color_scale = ["steelblue","orange"]
        var lineLegend = svg.selectAll(".lineLegend").data(legend_keys)
        .enter().append("g")
        .attr("class","lineLegend")
        .attr("transform", function (d,i) {
                return "translate(" + width + "," + (i*20)+")";
            });

        lineLegend.append("text").text(function (d) {return d;})
            .attr("transform", "translate(15,9)"); //align texts with boxes

        lineLegend.append("rect")
            .attr("fill", function (d, i) {return color_scale[i]; })
            .attr("width", 10).attr("height", 10);

        svg.selectAll(".line")
            .transition()
            .delay(500)
            .duration(750)
            .attr("stroke-width",3);

        svg.selectAll(".dot")
        .transition()
        .delay(600)
        .duration(800)
        .attr("r",6);

        svg.selectAll(".annotation")
        .transition()
        .delay(1000)
        .duration(1200)
        .style("opacity",1)
        .attr("class","annotation")
        .attr("fill","lightcoral");


        });
        });

</script>
</center>
</body>
</html>
