<!DOCTYPE html>
<html>
<head>
<title>
Scene 2
</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<center>
<div id="viz" width="600" height="600"></div>
<div id="tooltip"></div>
<input id="button" type="button" onclick="location.href='https://michael-d-johnson.github.io/about';" value="Description" style="float:right"/>
<input id="button" type="button" onclick="location.href='https://michael-d-johnson.github.io';" value="Back" style="float:right"/>
</center>

<style>
.annotation1 {
    opacity: 0;
    position: absolute;
    text-align: left;
    background: red;
}
.annotation2 {
    opacity: 0;
    position: absolute;
    text-align: left;
    background: red;
}
.annotation3 {
    opacity: 0;
    position: absolute;
    text-align: left;
    background: red;
}
#tooltip {
    opacity: 0;
    position: absolute;
    text-align: left;
    width: 100px; height: 35px;
    background: whitesmoke;
    border: 1px solid black;
    color: black;
}
#button {
   background: steelblue;
   color: white;
}
</style>
<script>
    // Source: https://bl.ocks.org/mbostock/3884955
    // http://blockbuilder.org/micahstubbs/d393bcfde0228430c00b

    var tooltip = d3.select("#tooltip");

    //set the margin of the SVG
    var margin = {top: 50, right: 100, bottom: 50, left: 100};

    //set the width and height using the current width and height of the SVG
    var width = 600 - margin.left - margin.right;
    var height = 600 - margin.top - margin.bottom;
    
    var x = d3.scaleBand()
        .range([0,width]);
    var y = d3.scaleLinear()
        .range([height,0]);

    var line = d3.line()
        .x(function(d) { return x(d.YEAR); })
        .y(function(d) { return y(d.TOTSAL); });

    // create the drop down menu
    var options = ["All Data", "Before 2000", "After 2000"];
    var selector = d3.select("#viz")
        .append("select")
        .attr("id", "checkbox")
        .selectAll("option")
        .data(options)
        .enter().append("option")
        .text(function(d) { return d; })
        .attr("value", function (d, i) {
            return d;
        });

    d3.select("#checkbox")
    .on("change", function(d) {
        index = this.value;
        filterData();});

    var filterData = function(){
        var selection =  document.getElementById("checkbox");
        var parameter = selection.options[selection.selectedIndex].value;
    
    d3.csv("../static/all_natl_data.filtered.NotAssisted.csv", function(error1,data1) {
        d3.csv("../static/all_natl_data.filtered.Assisted.csv",function(error2,data2) {
            if (error1) throw error;
                if (error2) throw error;
                //format the data
                data1.forEach(function(d) {
                    d.YEAR = +d.YEAR;
                    d.TOTALCOST = +d.TOTALCOST
                    d.TOTSAL = +d.TOTSAL;});
                data2.forEach(function(d) {
                    d.YEAR = +d.YEAR;
                    d.TOTALCOST = +d.TOTALCOST
                    d.TOTSAL = +d.TOTSAL;});
            
            if (parameter == "All Data"){
                    data1 =  data1;
                    data2 = data2;}
            else{
                if (parameter =="After 2000" ){
                    data1 = data1.filter(function(d) {
                        return d.YEAR > 1999;});
                    data2 = data2.filter(function(d) {
                        return d.YEAR > 1999;})}
                else{
                    data1 = data1.filter(function(d) {
                        return d.YEAR < 2000;});
                    data2 = data2.filter(function(d) {
                        return d.YEAR < 2000;})};};

            //printing data
            //console.log(data1); 
            //console.log(data2);

            x.domain(data1.map(function(d) { return d.YEAR;}));
            y.domain([0,d3.max(data1,function(d) {return d.TOTSAL;})]);

        d3.selectAll("svg").remove();

        var svg = d3.select("#viz").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height",height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

        svg.append("path")
        .datum(data1)
        .attr("fill", "none")
        .attr("class","line")
        .attr("stroke", "orange")
        .attr("stroke-width", 3)
        .attr("d", line);
    
        svg.append("path")
        .datum(data2)
        .attr("fill", "none")
        .attr("class","line")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 3)
        .attr("d", line);
   
         svg.selectAll("dot")
        .data(data1)
        .enter().append("circle")
        .attr("fill","orange")
        .attr("r",6)
        .attr("cx", function(d) { return x(d.YEAR); })
        .attr("cy", function(d) { return y(d.TOTSAL); })
        .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html("Year: " + d.YEAR + "<br/>Salary: $" + d.TOTSAL)
                   .style("font-size","14px")
                   d3.select(this).attr("r",10)})
        .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("r", 6)});

        svg.selectAll("dot")
        .data(data2)
        .enter().append("circle")
        .attr("fill","steelblue")
        .attr("r",6)
        .attr("cx", function(d) { return x(d.YEAR); })
        .attr("cy", function(d) { return y(d.TOTSAL); })
        .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html("Year: " + d.YEAR + "<br/>Salary: $" + d.TOTSAL)
                   .style("font-size","14px")
                   d3.select(this).attr("r",10)})
        .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("r", 6)});

        svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));
        
        svg.append("g")
        .call(d3.axisLeft(y));

        // add labels
        svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "20px") 
        .style("text-decoration", "underline")  
        .style("text-decoration","bold")
        .text("Average Household Salaries: Subsidized vs. Unsubsidized");

        svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", 0 - (height / 2))
        .attr("y",0 - 50)
        .style("text-anchor", "middle")
        .text("Average Household Salary (USD)");

        svg.append("text")
        .attr("class", "x label")
        .attr("text-anchor", "middle")
        .attr("x", width/2 )
        .attr("y", height + margin.bottom)
        .text("Year");

        // adding legend
        var legend_keys = ["Assisted", "Unassisted"];

        var color_scale = ["steelblue","orange"];

        var lineLegend = svg.selectAll(".lineLegend").data(legend_keys)
        .enter().append("g")
        .attr("class","lineLegend")
        .attr("transform", function (d,i) {
                return "translate(" + width + "," + (i*20)+")";
            });

        lineLegend.append("text").text(function (d) {return d;})
            .attr("transform", "translate(15,9)"); //align texts with boxes

        lineLegend.append("rect")
            .attr("fill", function (d, i) {return color_scale[i]; })
            .attr("width", 10).attr("height", 10);

        // annotation 1
        var dot1= svg.selectAll(".dot")
        .data(data1)
        .enter().append("circle")
        .filter(function(d) {return d.YEAR==1997;})
            .attr("fill","orange")
            .attr("r",6)
            .attr("cx", function(d) { return x(d.YEAR); })
            .attr("cy", function(d) { return y(d.TOTSAL); })
            .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html("Year: " + d.YEAR + "<br/>Salary: $" + d.TOTSAL)
                   .style("font-size","14px")
                   d3.select(this).attr("r",10)})
            .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("r", 6)})

        // text 1
        svg.append("text")
        .attr("class", "annotation1")
        .attr("text-anchor", "middle")
        .attr("y", 250)
        .attr("x",85)
        .text("This is an annotation.");

        // transition 1
        dot1
        .transition()
        .delay(1000)
        .duration(1200)
        .attr("opacity", 1)
        .attr("fill","red");

        svg.selectAll(".annotation1")
        .transition()
        .delay(1000)
        .duration(1200)
        .style("opacity",1)
        .attr("class","annotation1")
        .attr("fill","red");

        // annotation 2
        svg.selectAll(".dot")
        .data(data2)
        .enter().append("circle")
        .filter(function(d) {return d.YEAR==2007;})
            .attr("fill","steelblue")
            .attr("r",6)
            .attr("cx", function(d) { return x(d.YEAR); })
            .attr("cy", function(d) { return y(d.TOTSAL); })
            .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html("Year: " + d.YEAR + "<br/>Salary: $" + d.TOTSAL)
                   .style("font-size","14px")
                   d3.select(this).attr("r",10)})
            .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("r", 6)})
        .transition()
        .delay(5000)
        .duration(1200)
        .attr("opacity", 1)
        .attr("fill","red");

        // text 2
        svg.append("text")
        .attr("class", "annotation2")
        .attr("text-anchor", "middle")
        .attr("y", 260)
        .attr("x", 400)
        .text("This is another annotation.");

        // transition 2
        svg.selectAll(".annotation2")
        .transition()
        .delay(5000)
        .duration(1200)
        .style("opacity",1)
        .attr("class","annotation2")
        .attr("fill","red");

        // annotation 3
        svg.selectAll(".dot")
        .data(data1)
        .enter().append("circle")
        .filter(function(d) {return d.YEAR==2007;})
            .attr("fill","orange")
            .attr("r",6)
            .attr("cx", function(d) { return x(d.YEAR); })
            .attr("cy", function(d) { return y(d.TOTSAL); })
            .on("mouseover",function(d){
            tooltip.style("opacity",1)
                   .style("left",(d3.event.pageX)+"px")
                   .style("top",(d3.event.pageY)+"px")
                   .html("Year: " + d.YEAR + "<br/>Salary: $" + d.TOTSAL)
                   .style("font-size","14px")
                   d3.select(this).attr("r",10)})
            .on("mouseout",function() { tooltip.style("opacity",0);
                                    d3.select(this).attr("r", 6)})
        .transition()
        .delay(9000)
        .duration(1200)
        .attr("opacity", 1)
        .attr("fill","red");
    
        // text 3
        svg.append("text")
        .attr("class", "annotation3")
        .attr("text-anchor", "middle")
        .attr("y", 100)
        .attr("x", 400)
        .text("This is yet another annotation.");

        // transition 3
        svg.selectAll(".annotation3")
        .transition()
        .delay(9000)
        .duration(1200)
        .style("opacity",1)
        .attr("class","annotation3")
        .attr("fill","red");
        });
        });
        };
filterData();
</script>
</body>
</html>
